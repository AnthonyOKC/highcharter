!function(H){function isArray(obj){return"[object Array]"===Object.prototype.toString.call(obj)}function Motion(chart){function handleKeyEvents(e){switch(e=e||window.event,e.which){case 32:motion.togglePlayPause();break;case 37:motion.playRange.value=motion.round(parseFloat(motion.playRange.value)-1),motion.updateChart(motion.playRange.value);break;case 39:motion.playRange.value=motion.round(parseFloat(motion.playRange.value)+1),motion.updateChart(motion.playRange.value);break;default:return}e.preventDefault()}var motion=this;this.chart=chart,this.paused=!0,this.options=H.merge(this.defaultOptions,this.chart.options.motion),this.dataSeries=[],this.dataLength=0,motion.options.series=H.splat(motion.options.series),Highcharts.each(this.chart.series,function(series,index){if(motion.options.series.indexOf(index)>=0){motion.dataSeries[index]=series;for(var i=0;i<series.data.length;i++)series.data[i].sequence&&(motion.dataLength=Math.max(motion.dataLength,series.data[i].sequence.length))}}),this.playControls=H.createElement("div",{id:"play-controls"},null,this.chart.renderTo,null),this.playPauseBtn=H.createElement("button",{id:"play-pause-button",title:"play"},null,this.playControls,null),this.playPauseBtn.className=this.options.playIcon,this.playRange=H.createElement("input",{id:"play-range",type:"range",min:0,max:this.dataLength-1,step:this.options.magnet.step},null,this.playControls,null),this.playRange.value=H.pick(this.options.startIndex,this.dataLength-1),this.playOutput=H.createElement("label",{id:"play-output",name:this.options.axisLabel},null,this.playControls,null),this.playOutput.innerHTML=isArray(this.options.labels)?this.options.labels[this.dataLength-1]||"":this.dataLength-1,Highcharts.addEvent(this.playPauseBtn,"click",function(){motion.togglePlayPause()}),Highcharts.addEvent(this.playRange,"mouseup",function(){motion.attractToStep()}),Highcharts.addEvent(this.playRange,"input",function(){motion.updateChart(this.value)}),Highcharts.addEvent(this.playControls,"click",function(){motion.playRange.focus()}),Highcharts.addEvent(this.playPauseBtn,"keydown",handleKeyEvents),Highcharts.addEvent(this.playRange,"keydown",handleKeyEvents),this.inputValue=parseFloat(this.playRange.value),this.updateChart(this.inputValue),this.options.autoPlay&&this.play()}Motion.prototype.defaultOptions={enabled:!0,axisLabel:"year",autoPlay:!1,loop:!1,series:0,updateInterval:10,magnet:{round:"round",step:.01},playIcon:"fa fa-play",pauseIcon:"fa fa-pause"},Motion.prototype.togglePlayPause=function(){this[this.paused?"play":"pause"]()},Motion.prototype.play=function(){var motion=this;this.paused&&parseFloat(this.playRange.value)===parseFloat(this.playRange.max)&&this.reset(),this.changeButtonType("pause"),this.paused=!1,this.timer=setInterval(function(){motion.playUpdate()},this.options.updateInterval)},Motion.prototype.pause=function(){this.changeButtonType("play"),this.paused=!0,window.clearInterval(this.timer),this.attractToStep()},Motion.prototype.reset=function(){this.playRange.value=this.playRange.min,this.updateChart(this.playRange.value)},Motion.prototype.changeButtonType=function(value){this.playPauseBtn.title=value,this.playPauseBtn.className=value+" ","play"==value?this.playPauseBtn.className+=this.options.playIcon:"pause"==value&&(this.playPauseBtn.className+=this.options.pauseIcon)},Motion.prototype.playUpdate=function(){this.paused||(this.inputValue=parseFloat(this.playRange.value),this.playRange.value=this.inputValue+this.options.magnet.step,this.attractToStep(),this.updateChart(this.playRange.value),this.playRange.value>=parseFloat(this.playRange.max)&&(this.options.loop?this.reset():this.pause()))},Motion.prototype.updateChart=function(inputValue){var seriesKey,series,point,i,roundedInput=this.round(inputValue);if(this.currentAxisValue!==roundedInput){this.currentAxisValue=roundedInput,this.chart.options.motion.startIndex=roundedInput;for(seriesKey in this.dataSeries)if(this.dataSeries.hasOwnProperty(seriesKey))for(series=this.dataSeries[seriesKey],i=0;i<series.data.length;i++){point=series.data[i];try{point.sequence&&point.update(point.sequence[roundedInput],!1,!1)}catch(e){console.error("Error:",e," \nat point:",point," \nwith new value:",point.sequence[roundedInput])}}this.chart.redraw(),this.attractToStep()}},Motion.prototype.attractToStep=function(){this.playOutput.innerHTML=isArray(this.options.labels)?this.options.labels[this.round(this.playRange.value)]||"":this.round(this.playRange.value)},Motion.prototype.round=function(number){return Math[this.options.magnet.round](number)},H.Chart.prototype.callbacks.push(function(chart){chart.options.motion&&chart.options.motion.enabled&&(chart.motion=new Motion(chart))}),H.Motion=Motion}(Highcharts);
