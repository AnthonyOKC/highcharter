HTMLWidgets.widget({name:"highchart",type:"output",initialize:function(){return{}},renderValue:function(el,x){if(x.debug&&(window.xclone=JSON.parse(JSON.stringify(x)),window.elclone=$(el),console.log(el),console.log("hc_opts",x.hc_opts),console.log("theme",x.theme),console.log("conf_opts",x.conf_opts)),void 0!==x.fonts&&(x.fonts="string"==typeof x.fonts?[x.fonts]:x.fonts,x.fonts.forEach(function(s){var urlfont="https://fonts.googleapis.com/css?family="+s;$("link[href='"+urlfont+"']").length||$('<link href="'+urlfont+'" rel="stylesheet" type="text/css">').appendTo("head")})),ResetHighchartsOptions(),null!==x.theme&&(x.debug&&console.log("adding THEME"),Highcharts.setOptions(x.theme)),(x.theme&&void 0!==x.theme.chart.divBackgroundImage)|(x.hc_opts.chart&&void 0!==x.hc_opts.chart.divBackgroundImage)){x.debug&&console.log("adding BackgroundImage");var bkgrnd=x.theme.chart.divBackgroundImage||x.hc_opts.chart.divBackgroundImage;Highcharts.wrap(Highcharts.Chart.prototype,"getContainer",function(proceed){proceed.call(this),$("#"+el.id).css("background-image","url("+bkgrnd+")"),$("#"+el.id).css("-webkit-background-size","cover"),$("#"+el.id).css("-moz-background-size","cover"),$("#"+el.id).css("-o-background-size","cover"),$("#"+el.id).css("background-size","cover")})}if(Highcharts.setOptions(x.conf_opts),"chart"==x.type?(x.debug&&console.log("charting CHART"),$("#"+el.id).highcharts(x.hc_opts)):"stock"==x.type?(x.debug&&console.log("charting STOCK"),$("#"+el.id).highcharts("StockChart",x.hc_opts)):"map"==x.type?(x.debug&&console.log("charting MAP"),x.hc_opts.series=x.hc_opts.series.map(function(e){return e.geojson===!0&&(x.debug&&console.log("geojson\n	",e.type,"\n	",typeof e.series),e.data=Highcharts.geojson(e.data,e.type)),e}),$("#"+el.id).highcharts("Map",x.hc_opts),void 0!==x.hc_opts.mapNavigation&&x.hc_opts.mapNavigation.enabled===!0&&$("#"+el.id).bind("mousewheel DOMMouseScroll",function(e){var e0=e.originalEvent,delta=e0.wheelDelta||-e0.detail;this.scrollTop+=30*(0>delta?1:-1),e.preventDefault()})):"gantt"==x.type&&(x.debug&&console.log("charting GANTT"),chart=Highcharts.ganttChart(el.id,x.hc_opts)),void 0!==x.hc_opts.motion){$("#"+el.id).css({position:"relative"}),x.debug&&console.log("setting MOTION options");var pc=$($("#"+el.id).find("#play-controls")[0]),ct=x.theme.chart;void 0!==ct.backgroundColor&&$(pc.find("#play-pause-button")[0]).css({backgroundColor:x.theme.chart.backgroundColor}),void 0!==ct.style&&$(pc.find("#play-output")[0]).css(x.theme.chart.style),void 0!==ct.style&&void 0!==ct.style.color&&$(pc.find("#play-pause-button")[0]).css({color:x.theme.chart.style.color})}},resize:function(el){var chart=$("#"+el.id).highcharts();if(chart&&chart.options.chart.reflow===!0){var w=chart.renderTo.clientWidth,h=chart.renderTo.clientHeight;chart.setSize(w,h)}}}),HTMLWidgets.shinyMode&&(Shiny.addCustomMessageHandler("addSeries",function(msg){var chart=$("#"+msg.id).highcharts();chart.addSeries(msg.series)}),Shiny.addCustomMessageHandler("removeSeries",function(msg){var chart=$("#"+msg.id).highcharts();chart.get(msg.idSeries).remove()}),Shiny.addCustomMessageHandler("removeAllSeries",function(msg){for(var chart=$("#"+msg.id).highcharts();chart.series.length;)chart.series[0].remove()}),Shiny.addCustomMessageHandler("updateChart",function(msg){var chart=$("#"+msg.id).highcharts();chart.update(msg.options)}),Shiny.addCustomMessageHandler("updateSeries",function(msg){var chart=$("#"+msg.id).highcharts();chart.get(msg.idSeries).update(msg.options)}),Shiny.addCustomMessageHandler("showLoading",function(msg){var chart=$("#"+msg.id).highcharts();msg.showLoading?chart.showLoading():chart.hideLoading()}),Shiny.addCustomMessageHandler("addPoint",function(msg){var chart=$("#"+msg.id).highcharts();chart.get(msg.idSeries).addPoint(msg.point,msg.redraw,msg.shift,msg.animation)}),Shiny.addCustomMessageHandler("removePoint",function(msg){var chart=$("#"+msg.id).highcharts();chart.get(msg.idSeries).removePoint(msg.i,msg.redraw)}),Shiny.addCustomMessageHandler("setData",function(msg){var chart=$("#"+msg.id).highcharts();"undefined"!=typeof chart&&chart.series[msg.serie].setData(data=msg.data,redraw=msg.redraw,animation=msg.animation,updatePoints=msg.updatePoints)}),Shiny.addCustomMessageHandler("redraw",function(msg){var chart=$("#"+msg.id).highcharts();"undefined"!=typeof chart&&chart.redraw()}));
